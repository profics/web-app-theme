<div class="block">
  <div class="secondary-navigation">
    <ul class="wat-cf">
    <%%-
      nav_partial = navigation_partial
      if nav_partial != nil
    -%>
    <%%= render(:partial => nav_partial, :object => nil, :locals => {:action => :index}) %>
    <%%-
      else
    -%>
        <li class="first active"><%%= link_to t_wat(:list), <%= controller_routing_path %>_path  %></li>
        <li><%%= link_to t_wat(:new), new_<%= singular_controller_routing_path %>_path %></li>
    <%%-
      end
    -%>
  </ul>
  </div>
  <div class="content">
    <h2 class="title"><%%= t_wat(:all) %> <%%= t_klasses %></h2>
    <div class="inner">
      <table class="table">
        <tr>
          <th class="first">Id</th>
          <%- columns.each do |column| -%>
            <th>
              <%%= t_attr(:<%= column.name %>) %>
            </th>
          <%- end -%>
          <th class="last">&nbsp;</th>
        </tr>
        <%% @<%= plural_resource_name %>.each do |<%= resource_name %>| -%>
        <tr class="<%%= cycle("odd", "even") %>">
          <td class="first">
            <%%= link_to <%= resource_name %>.id, <%= singular_controller_routing_path %>_path(<%= resource_name %>) %>
          </td>
          <%-
            current_model = model_name.constantize
            columns.each do |column|
              column_name = column.name.sub(/_id$/, '')
              reflection = current_model.reflect_on_association(column_name.to_sym)
              if reflection && !reflection.options[:polymorphic]
                reference_class_name = reflection.klass.name.underscore.gsub(/\//, '_')
          -%>
                <td>
                  <%%=
                    if <%= resource_name %>.<%= column_name %> then
                      link_to <%= resource_name %>.<%= column_name %>, <%= reference_class_name %>_path(<%= resource_name %>.<%= column_name %>)
                    else
                      <%= resource_name %>.<%= column_name %>
                    end
                  %>
                </td>
          <%-
              elsif column.type == :boolean
          -%>
                <td>
                  <%%=
                    if <%= resource_name %>.<%= column_name %> == true then
                      content_tag(:span, <%= resource_name %>.<%= column_name %>, :class => 'value_boolean value_boolean_true')
                    else
                      content_tag(:span, <%= resource_name %>.<%= column_name %>, :class => 'value_boolean value_boolean_false')
                    end
                  -%>
                </td>
          <%-
              else
          -%>
                <td>
                  <%%= <%= resource_name %>.<%= column_name %> %>
                </td>
          <%-
              end
          -%>
          <%- end -%>
          <td class="last">
            <%%= link_to content_tag(:span, t_wat(:show), :class => 'link link_show'), <%= singular_controller_routing_path %>_path(<%= resource_name %>) %>
            <%%= content_tag(:span, " | ", :class => 'link_seperator') %>
            <%%= link_to content_tag(:span, t_wat(:edit), :class => 'link link_edit'), edit_<%= singular_controller_routing_path %>_path(<%= resource_name %>) %>
            <%%= content_tag(:span, " | ", :class => 'link_seperator') %>
            <%%= link_to content_tag(:span, t_wat(:delete), :class => 'link link_delete'), <%= singular_controller_routing_path %>_path(<%= resource_name %>), :method => :delete, :data => {:confirm => t_wat(:confirm)} %>
          </td>
        </tr>
        <%% end -%>
      </table>
      <div class="actions-bar wat-cf">
        <div class="actions">
        </div>
        <% if options.paginate %>
        <%%= paginate @<%= plural_resource_name %>  %>
        <% end %>
      </div>
    </div>
  </div>
</div>

<%%- sidebar_partials.each do |sidebar_partial| -%>
  <%%- content_for :sidebar, render(:partial => sidebar_partial) -%>
<%%- end -%>
